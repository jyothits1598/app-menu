<form [formGroup]="modifierForm" (ngSubmit)="saveModifer(modifierForm.value)">
    <div class="row" style="margin-top:-24px;">
        <div class="col-md-12">
            <div class="float-right">
                <button class="btn std-button std-button--redtransparency" type="button" *ngIf="modifierId"
                    (click)="modalService.open(deleteComform, { centered: true, size:'sm' });"> Delete </button>
                <button class="btn std-button std-button--transparency" style="margin-left:10px;" type="button">
                    Duplicate
                </button>
                <button appBtnIcon [valid]="modifierForm.valid" [loading]="submitting" class="btn std-button-active"
                    style="margin-left:10px;"> <span #span>Save</span> </button>
            </div>
        </div>
        <div class="col-md-12">
            <div class="input-container">
                <img (click)="modifierForm.dirty? modalService.open(backConfirm, { centered: true, size: 'sm' }) : navigateBack()"
                    src="../../../../../assets/images/ico_back.png" class="input-img mt-1">
                <input focusOnLoad type="text" class="input-border input-palceholder" formControlName="name">
                <span class="error-mez"
                    *ngIf="modifierForm.controls.name.touched && modifierForm.controls.name.invalid">Item name is
                    required.</span>
            </div>
        </div>
    </div>
    <!--------------------------- Rules start --------------------->
    <div class="row" >
        <div class="col-md-12">
            <h4 class="std-heading-4" style="margin-bottom: 32px;margin-top: 56px;"> Rules <img
                src="../../../../../assets/images/ico_help.png" style="cursor:pointer" title="info" (click)="openDisplyinfo(displaytext)"></h4>
        </div>
        <div class="col-md-3">          
            <h5 class="std-heading-5" style="margin-bottom: 4px;"> Select minimum </h5>
            <select class="custom-select form-input" >
                <option> Select </option>
            </select>
        </div>
        <div class="col-md-3">
            <h5 class="std-heading-5" style="margin-bottom: 4px;"> Select maximum </h5>
            <select class="custom-select form-input" >
                <option> Select </option>
            </select>
        </div>
        <div class="col-md-3">          
            <h5 class="std-heading-5" style="margin-bottom: 4px;"> Select free </h5>
            <select class="custom-select form-input" >
                <option> Select </option>
            </select>
        </div>
    </div>
    <!--------------------------- Rules start end --------------------->
    <!--------------------------- Rules start --------------------->
    <div class="row" >
        <div class="col-md-12">
            <h4 class="std-heading-4" style="margin-bottom: 32px;margin-top: 56px;"> Options </h4>
            <!------------------- looping add option ------------>
            <div class="row">
                <div class="col-md-3">
                    <h5 class="std-heading-5" style="margin-bottom: 4px;"> Name </h5>
                    <input type="text" class="form-control form-input" placeholder="Enter name"/>
                </div>
                <div class="col-md-3">
                    <h5 class="std-heading-5" style="margin-bottom: 4px;"> Price </h5>
                    <input type="text" class="form-control form-input" placeholder="+$"/>
                </div>
                <div class="col-md-3" style="padding-top: 36px;">
                    <span class="blue-text" > 
                        <img src="../../../../../assets/images/ico_delete.png" >&nbsp; Delete </span> 
                </div>
            </div>
            <!------------------- looping add option end ------------>
            <div class="row">
                <div class="col-md-12">
                    <button class="btn std-button std-button--transparency" type="button" style="margin-top:32px">
                        <img src="../../../../../assets/images/ico_add_blue.png" >&nbsp; Add option
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <h4 class="std-heading-4" style="margin-bottom: 32px;margin-top: 56px;"> Used by </h4>
            <table class="table table-border table-color">
                <thead>
                    <tr>
                        <th> Item </th>
                        <th> Category </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody >
                    <tr class="text-capitalize" >
                        <td class="table-name"> Item name </td>
                        <td> saef </td>
                        <td style="text-align: right;outline: none;">
                            <div class="dropdown">
                                <img src="../../../../../assets/images/ico_overflow.png" class="dropdown-toggle" style="cursor:pointer;"
                                    data-toggle="dropdown" title="Options">
                                <ul class="dropdown-menu dropdown-edit dropdown-menu-right">
                                    <li title="Delete" class="herf-class" >
                                        <img src="../../../../../assets/images/ico_delete_black.png">&nbsp;&nbsp;
                                        Delete
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                </tbody>
                <!-- <ng-template #noItems>
                    <tbody>
                        <tr class="text-center">
                            <td colspan="6">No items have been added yet.</td>
                        </tr>
                    </tbody>
                </ng-template> -->
            </table>
        </div>        
    </div>
    <!--------------------------- Rules start end --------------------->

    
    <!-- below design changed -->
    
    <div class="row">
        <div class="col-md-12">
            <h4 class="std-heading-4" style="margin-bottom: 32px;margin-top: 56px;"> Custom display text <img
                src="../../../../../assets/images/ico_help.png" style="cursor:pointer" title="info" (click)="openDisplyinfo(displaytext)"></h4>
            <h5 class="std-heading-5" style="margin-bottom: 4px;"> Display text </h5>
        </div>
        <div class="col-md-3">
            <input formControlName="displayText" type="text" class="form-control form-input" placeholder="e.g Add a side" >
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h4 class="std-heading-4" style="margin-bottom: 32px;margin-top: 56px;"> Items <img
                    src="../../../../../assets/images/ico_help.png" style="cursor:pointer" title="info" (click)="openitemModifierCentered(itemModifier)"></h4>
            <h5 class="std-heading-5" style="margin-bottom: 4px;"> Add Item </h5>
        </div>
        <div class="col-md-3 mb-1">
            <div class="auto-fill">
                <incremental-search [apiFunction]="apiFun"
                    [accessorFunction]="nameAccessor"
                    (onSelect)="selectItem($event)">
                        <input #itemSearch placeholder="Search" class="form-control form-input search" />
                    <ng-template #itemTemplate let-option="option">
                        <li class="auto-fill__list__item">{{option.item_name}}</li>
                    </ng-template>
                    <ng-template #noItemsTemplate>
                        <li class="auto-fill__list__item">No results found</li>
                    </ng-template>
                </incremental-search>
            </div>
        </div>
        <div class="col-md-3">
            <button type="button"  class="btn std-button std-button--primary" type="button" style="padding:12px 16px"
                routerLink="../../items/new">Add </button>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-12">
            <table class="table table-border table-color" formArrayName="selectedItems" style="margin-top: 32px;">
                <thead>
                    <tr>
                        <th> Name </th>
                        <th> Standard price </th>
                        <th> Modifier price </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody *ngIf="selectedItems.length > 0; else noItems">
                    <tr class="text-capitalize" *ngFor="let item of selectedItems; let i = index">
                        <td class="table-name">{{item.name}}</td>
                        <td>${{item.basePrice | number:'1.2-2'}}</td>
                        <td (click)="editedItemIndex=i; modalService.open(popup, { centered: true, size: 'sm' });" style="cursor: pointer;">
                            <span> <img src="../../../../../assets/images/ico_edit_blue.png"></span>&nbsp;
                            <span>${{selectedItemsForm.at(i).value | number:'1.2-2'}}</span>
                        </td>
                        <td style="text-align: right;cursor:pointer;outline: none;">
                            <div class="dropdown">
                                <img src="../../../../../assets/images/ico_overflow.png" class="dropdown-toggle"
                                    data-toggle="dropdown" title="Options">
                                <ul class="dropdown-menu dropdown-edit dropdown-menu-right">
                                    <li title="Delete" class="herf-class"
                                        (click)="this.selectedItemsForm.markAsTouched({onlySelf: true}); deleteItem(i);">
                                        <img src="../../../../../assets/images/ico_delete_black.png">&nbsp;&nbsp;
                                        Delete
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                </tbody>
                <ng-template #noItems>
                    <tbody>
                        <tr class="text-center">
                            <td colspan="6">No items have been added yet.</td>
                        </tr>
                    </tbody>
                </ng-template>
            </table>
            <p *ngIf="selectedItemsForm.invalid && selectedItemsForm.touched" style="color: var(--color-failure);">
                Please add atleast one item.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h4 class="std-heading-4" style="margin-top:64px;margin-bottom:32px;"> Rules <img
                    src="../../../../../assets/images/ico_help.png" style="cursor:pointer" title="info"></h4>
            <h5 class="std-heading-5" style="margin-bottom: 3px;"> Is this a required selection? </h5>
            <div class="checkbox" style="cursor: pointer;">
                <label style="margin-bottom:0;">
                    <input type="checkbox" style="height:auto" formControlName="selectionRequired" >
                        &nbsp;Yes, customer is required to make a selection
                </label>
            </div>
            
            <h5 class="std-heading-5" style="margin-bottom: 3px;margin-top:32px;"> Maximum items selected (leave blank for unlimited)</h5>
            <div class="row">
                <div class="col-md-3">
                    <input type="number" class="form-control form-input"  formControlName="maxItemsSelectable" placeholder="Enter maximum">
                </div>
            </div>
        </div>
    </div>
</form>





<ng-template #popup let-editPopup>
    <form (ngSubmit)="updatePrice(valInput.value)">
        <div class="modal-header header-info">
            <div class="std-heading-5 std-heading-5--popheader"> {{selectedItems[editedItemIndex].name}} </div>
        </div>
        <div class="modal-body">
            <label class="label-inputs"> Modifier price </label>
            <div class="prefixed-input" style="margin-bottom: 64px;">
                <span class="prefixed-input__prefix">$</span>
                <input class="form-control form-input prefixed-input__input" #valInput type="number"
                    [value]="selectedItemsForm.at(editedItemIndex).value">
            </div>
            <div style="float: right;margin-bottom: 16px;">
                <button (click)="editPopup.dismiss('Cross click')" type="button" class="btn std-button std-button--transparency" style="margin-right:16px">Cancel</button>
                <button (click)="updatePrice(valInput.value); editPopup.dismiss('Cross click')" class="btn std-button std-button--primary">Save</button>
            </div>
        </div>
    </form>
</ng-template>

<ng-template #deleteComform let-deleteConf>
    <div class="modal-body text-center">
        <h4 class="std-heading-4 mb-2"> Deleting modifier group
            {{modifierForm.value.name? '"'+modifierForm.value.name+'"' : ''}} </h4>
        <p class="mb-2">
            Are you sure?
        </p>
        <button class="std-button std-button--plane" (click)="deleteModifier(); deleteConf.dismiss('Cross click')">
            Delete </button>
        <hr style="margin: 0;">
        <button class="std-button std-button--plane" (click)="deleteConf.dismiss('Cross click')"> Cancel </button>
    </div>
</ng-template>

<ng-template #backConfirm let-backConf>
    <div class="modal-body text-center">
        <h4 class="std-heading-4 mb-2"> Unsaved changes </h4>
        <p class="mb-2">
            If you continue you will lose any unsaved progress
        </p>
        <button class="std-button std-button--plane" (click)="navigateBack(); backConf.dismiss('Cross click')"> Continue
        </button>
        <hr style="margin: 0;">
        <button class="std-button std-button--plane" (click)="backConf.dismiss('Cross click')"> Cancel </button>
    </div>
</ng-template>

<!-- Info modal -->
<ng-template #itemModifier let-modal>
    <div class="modal-header header-info">
      <div class="std-heading-5 std-heading-5--popheader"> Items </div>
      <button type="button" class="close info-q" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true"><img src="../../../../../assets/images/x.png"></span>
      </button>
    </div>
    <div class="modal-body">
      <p class="paragraph"> 
          To add items like <b>Chips</b> or <b>Salad</b> to modifier groups you must first create them
          via the <b>Items*</b> tab. Once created, search for the item here and press <b>Add</b> to add it to the group.
      </p>
      <p>
          Use modifier groups to offer other flexible options like <b>Sizes</b> or <b>Exclusions.</b> For example you may create items for <b>Small, Medium</b> and <b>Large*</b> and
          add them to a modifier group <b>Burger size</b> or <b>Coffee size.</b>
      </p>
      <p>
          To keep variations to a minimum you may also overide the default price of an 
          <b>Item</b> within different groups, so for example, a <b>large</b> burger is a different price modification than a <b>large</b> coffee.
      </p>
      <p style="font-size: 14px;">
          *When creating an <b>item</b> you can decide whether or not to sell it on its own. This flexibility is 
          handy if you want to sell extras or sides individually or for exluding items like <b>sizes</b> from appearing in your menu.
      </p>
    </div>
</ng-template>
<!-- Info modal end-->
<!-- Info modal -->
<ng-template #displaytext let-modal>
    <div class="modal-header header-info">
      <div class="std-heading-5 std-heading-5--popheader"> Custom display text </div>
      <button type="button" class="close info-q" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true"><img src="../../../../../assets/images/x.png"></span>
      </button>
    </div>
    <div class="modal-body">
      <p class="paragraph">
           Here you can customise the text your customers will see when presented with
           the modifier options; e.g. "Add sides", "Go large?" or "Do you want fries with that?"
        </p>
    
    </div>
</ng-template>
<!-- Info modal end-->
