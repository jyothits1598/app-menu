<div class="container h-100 m-class">
    <form [formGroup]="storeDetailform" (ngSubmit)="storeDetails()">
        <h1 class="form-header" style="margin-bottom:72px;">
            Tell us a little about your store
        </h1>
        <div class="form-group form-group--margin">
            <label class="label-inputs"> Store name <b class="m-star">*</b> </label>
            <input type="text" class="form-control form-input" placeholder="e.g. Mikes's Burgers"
                formControlName="storeName" [ngClass]="{ 'is-invalid': storeNameSubmit && f.storeName.errors }">
            <div *ngIf="storeNameSubmit && f.storeName.errors" class="error-mez">
                <div *ngIf="f.storeName.errors.required"> Please enter store name </div>
            </div>
        </div>
        <div class="form-group form-group--margin">
            <label class="label-inputs"> Store address <b class="m-star">*</b> </label>
            <!-- <input type="text" class="form-control form-input" placeholder="e.g. 100 Main street, Sampletown, Qld 4000" formControlName="storeAddress" #storeAddress [ngClass]="{ 'is-invalid': storeAddressSubmit && f.storeAddress.errors }" >
        <ngx-google-places-autocomplete formControlName="place"></ngx-google-places-autocomplete>
        <div *ngIf="storeAddressSubmit && f.storeAddress.errors" class="error-mez">
            <div *ngIf="f.storeAddress.errors.required"> Please enter store address </div>
        </div> -->
            <input ngx-google-places-autocomplete [options]='options' (onAddressChange)="AddressChange($event)"
                class="form-control form-input" formControlName="storeAddress"
                [ngClass]="{ 'is-invalid': storeAddressSubmit && f.storeAddress.errors }"
                placeholder="e.g. 100 Main street, Sampletown, Qld 4000" />
            <div *ngIf="storeAddressSubmit && f.storeAddress.errors" class="error-mez">
                <div *ngIf="f.storeAddress.errors.required"> Please enter store address </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group form-group--margin">
                    <label class="label-inputs"> Type of cuisine <b class="m-star">*</b> </label>
                    <select class="form-control custom-select form-input form-input--select-input"
                        formControlName="typeCuisine" (ngModelChange)="changeCuisine()"
                        [ngClass]="{ 'is-invalid': typeCuisineSubmit && f.typeCuisine.errors }">
                        <option value=""> Select </option>
                        <option *ngFor="let cuisine of Cuisines" value="{{cuisine.cuisine_id}}">
                            {{ cuisine.cuisine_name }} </option>
                    </select>
                    <div *ngIf="typeCuisineSubmit && f.typeCuisine.errors" class="error-mez">
                        <div *ngIf="f.typeCuisine.errors.required"> Please select type of cuisine </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group form-group--margin">
            <label class="label-inputs"> Description <b class="m-star">*</b> </label>
            <textarea class="form-control form-input" placeholder="Will be displayed in the app"
                formControlName="descriptionItem"
                [ngClass]="{ 'is-invalid': descriptionItemSubmit && f.descriptionItem.errors }"
                style="height:48px;"></textarea>
            <div *ngIf="descriptionItemSubmit && f.descriptionItem.errors" class="error-mez">
                <div *ngIf="f.descriptionItem.errors.required"> Please enter description </div>
            </div>
        </div>
        <div class="form-group form-group--margin">
            <label class="label-inputs"> Google business URL <b class="m-star"></b> </label>
            <input type="text" class="form-control form-input" placeholder="e.g. goo.gl/map/xxxxxxxx"
                formControlName="google_business_url"
                [ngClass]="{ 'is-invalid': googleBussinessSubmit && f.google_business_url.errors }">
            <div *ngIf="googleBussinessSubmit && f.google_business_url.errors" class="error-mez">
                <div *ngIf="f.google_business_url.errors.required"> Please enter Google business URL </div>
            </div>
        </div>
        <div class="form-group form-group--margin">
            <label class="label-inputs"> Facebook URL <b class="m-star"></b> </label>
            <input type="text" class="form-control form-input" placeholder="e.g. http://www.facebook.com/xxxxxxxx"
                formControlName="facebook_url"
                [ngClass]="{ 'is-invalid': facebookBussinessSubmit && f.facebook_url.errors }">
            <div *ngIf="facebookBussinessSubmit && f.facebook_url.errors" class="error-mez">
                <div *ngIf="f.facebook_url.errors.required"> Please enter Facebook URL </div>
            </div>
        </div>
        <div class="form-group form-group--margin">
            <label class="label-inputs"> Opening hours </label>
            <div class="d-flex justify-content-between" (click)="startEdit(editor)" style="cursor: pointer;"
                title=" {{storeOpeningHours.length == 0 ? 'Add opening hours' : 'Edit opening hours'}}">
                <div class="content-label"> {{storeOpeningHours.length == 0 ? 'Add' : 'Edit'}} opening hours </div>
                <img [src]="storeOpeningHours.length == 0 ? add_image : edit_image">
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div style="margin-top:32px">
                        <app-time-availability-summary [availabilities]="storeOpeningHours">
                        </app-time-availability-summary>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group form-group--null">
            <label class="label-inputs"> Store logo or photo </label>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-auto mr-auto">
                            <div class="upload-image" (click)="imageUrl? '' : fileInput.click()"
                                style="margin-bottom: 5px;">
                                <img src="assets/images/ico_add_blue.png" *ngIf="!imageUrl">
                                <img class="ud-image" [src]="imageUrl" *ngIf="imageUrl">
                                <div *ngIf="!imageUrl" class="std-heading-5" style="color:#353FA8;">Upload an image
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <div class="response-padding">
                                <span class="paragraph paragraph--small">JPG, PNG or GIF up to 5mb.<br> Minimum size
                                    500&times;500 pixels. </span>
                                <div style="margin-top:17px;">
                                    <button class="btn std-button std-button--primary" type="button"
                                        (click)="fileInput.click()"> Browse </button>
                                    <button class="btn std-button std-button--transparency" type="button"
                                        *ngIf="imageUrl" (click)="imageUrl = null" style="margin-left: 16px;"> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group mtop mbottom">
            <a [routerLink]="['/store/first-form']"> <input type="button"
                    class="btn std-button std-button--transparency" value="Cancel"></a>
            <input type="submit" class="btn std-button std-button--primary"
                value="{{add_edit_type == 'add' ? 'Save and continue' : 'Edit store'}}" style="margin-left:16px;">
        </div>
    </form>
    <input style="display: none" id="file" type="file" (change)="onFileChanged($event)" #fileInput
        accept=".jpg,.png,.jpeg,.gif">
</div>

<ng-template #openingHoursHeading>
    <div class="row">
        <div class="col-md-12" style="margin-top:32px;margin-bottom:32px;">
            <h4 class="std-heading-4" style="margin-top:64px;margin-bottom:32px;"> Opening hours </h4>
            <p class="paragraph"> Select <b>days</b> and <b>times</b> above and press <b>add time</b> to add opening
                hours.
            </p>
        </div>
    </div>
</ng-template>

<ng-template #editor>
    <div class="modal-header header-info">
        <div class="std-heading-4 std-heading-5--popheader"> Opening hours </div>
    </div>
    <div class="modal-body">
        <!-- <div class="row">
            <div class="col-md-12">
                <h4 class="std-heading-4" style="margin-top:64px;margin-bottom:32px;"> Opening hours </h4>
                <p class="paragraph">Select <strong>days</strong> and <strong>times</strong> above and press <strong>add
                        time</strong> to add opening hours.
                <p *ngIf="availability.length == 0 && availabilityTouched" class="error-mez">Please provide atleast one
                    availability</p>
            </div>
        </div> -->
        <time-availability-editor #editorComponent (onChange)="storeOpeningHours = $event"
            [availability]="storeOpeningHours" [headingTempalte]="openingHoursHeading">
        </time-availability-editor>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-12">
                    <div class="float-right" style="margin-bottom:16px;">
                        <button class="btn std-button std-button--transparency mr-sm-3"
                            (click)="storeOpeningHours = storeOpeningHoursCache; modalRef.dismiss()"> Cancel </button>
                        <button class="btn std-button std-button--primary" (click)="finalizeOpeningHours()"
                            [disabled]="!editorComponent.dirty">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>